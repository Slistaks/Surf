#include "filter.h"

/*static float filter_taps[SAMPLEFILTER_TAP_NUM] = {
  0.00025434404445126243,
  0.000525807199585712,
  0.0008450444187396493,
  0.001010093181795662,
  0.0007920780514866247,
  0.00000984460100662301,
  -0.0013421833234059267,
  -0.002990461892930242,
  -0.004367497930353802,
  -0.004734160973499318,
  -0.0034388653370623326,
  -0.0002489109604120828,
  0.004368746791938117,
  0.009160299238909993,
  0.012297543090650093,
  0.011902781475314154,
  0.0067748436290695204,
  -0.002907323249746718,
  -0.01517579908520726,
  -0.02638442086103065,
  -0.03192315224621254,
  -0.027419899918939918,
  -0.010120063876086757,
  0.019976971705033316,
  0.059622701111920876,
  0.10270550360071898,
  0.14149550939137068,
  0.16845271042630022,
  0.1781042909804655,
  0.16845271042630022,
  0.14149550939137068,
  0.10270550360071898,
  0.059622701111920876,
  0.019976971705033316,
  -0.010120063876086757,
  -0.027419899918939918,
  -0.03192315224621254,
  -0.02638442086103065,
  -0.01517579908520726,
  -0.002907323249746718,
  0.0067748436290695204,
  0.011902781475314154,
  0.012297543090650093,
  0.009160299238909993,
  0.004368746791938117,
  -0.0002489109604120828,
  -0.0034388653370623326,
  -0.004734160973499318,
  -0.004367497930353802,
  -0.002990461892930242,
  -0.0013421833234059267,
  0.00000984460100662301,
  0.0007920780514866247,
  0.001010093181795662,
  0.0008450444187396493,
  0.000525807199585712,
  0.00025434404445126243
};*/


//info de estos coef en el header.
static float filter_taps[SAMPLEFILTER_TAP_NUM] = {
		0.000000000000000000,-0.000002747692440615,-0.000012227786870791,-0.000026224361751648,
		-0.000036946450580623,-0.000032459592840534,0.000000000000000000,0.000069306888047067,
		0.000175281301583401,0.000304426440574813,0.000428093142776143,0.000504436707487784,
		0.000484959434003050,0.000325463338193895,-0.000000000000000001,-0.000484854632544722,
		-0.001079023603555671,-0.001685172352821584,-0.002165473841916680,-0.002360561373531813,
		-0.002119826038298030,-0.001339234064447209,0.000000000000000001,0.001800525320141083,
		0.003834839997152933,0.005755713040984271,0.007135045348876991,0.007529967494497120,
		0.006568964642349983,0.004045174430273592,-0.000000000000000003,-0.005221062972648795,
		-0.010956278107918908,-0.016269376776261224,-0.020046751364448522,-0.021141719379214597,
		-0.018547711746208274,-0.011574748956817781,0.000000000000000004,0.015835371902979380,
		0.035004314863497372,0.056057291419060282,0.077167803998820186,0.096343027561974076,
		0.111670871729237287,0.121567513683852768,0.124988016817509054,0.121567513683852768,
		0.111670871729237300,0.096343027561974076,0.077167803998820186,0.056057291419060282,
		0.035004314863497366,0.015835371902979380,0.000000000000000004,-0.011574748956817777,
		-0.018547711746208277,-0.021141719379214597,-0.020046751364448522,-0.016269376776261231,
		-0.010956278107918908,-0.005221062972648797,-0.000000000000000003,0.004045174430273591,
		0.006568964642349985,0.007529967494497121,0.007135045348876989,0.005755713040984274,
		0.003834839997152931,0.001800525320141084,0.000000000000000001,-0.001339234064447208,
		-0.002119826038298031,-0.002360561373531815,-0.002165473841916681,-0.001685172352821583,
		-0.001079023603555672,-0.000484854632544722,-0.000000000000000001,0.000325463338193895,
		0.000484959434003050,0.000504436707487785,0.000428093142776144,0.000304426440574812,
		0.000175281301583401,0.000069306888047067,0.000000000000000000,-0.000032459592840534,
		-0.000036946450580623,-0.000026224361751648,-0.000012227786870791,-0.000002747692440615,
		0.000000000000000000
};


void SampleFilter_init(SampleFilter* f) {
  int i;
  for(i = 0; i < SAMPLEFILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void SampleFilter_put(SampleFilter* f, float input) {
  f->history[f->last_index++] = input;
  if(f->last_index == SAMPLEFILTER_TAP_NUM)
    f->last_index = 0;
}

double SampleFilter_get(SampleFilter* f) {
  double acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < SAMPLEFILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : SAMPLEFILTER_TAP_NUM-1;
    acc += f->history[index] * filter_taps[i];
  };
  return acc;
}
